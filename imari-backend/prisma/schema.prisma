generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  password  String
  role      UserRole @default(USER)
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())

  transactions     Transaction[]
  staffPayrolls    StaffPayroll[]
  timelineEntries  TimelineEntry[]
  recordedExpenses Expense[]       @relation("RecordedExpenses")
  advances         Expense[]       @relation("StaffAdvances")
}

enum UserRole {
  ADMIN
  USER
  FINANCE
}

model Physician {
  id        String   @id @default(cuid())
  name      String   @unique
  active    Boolean  @default(true)
  createdAt DateTime @default(now())

  transactions Transaction[]
}

model Transaction {
  id            String        @id @default(cuid())
  clientName    String
  amount        Float
  discount      Float?
  notes         String?
  paymentMethod PaymentMethod

  physicianId String
  physician   Physician @relation(fields: [physicianId], references: [id])

  createdById String
  createdBy   User   @relation(fields: [createdById], references: [id])

  createdAt DateTime @default(now())
}

enum PaymentMethod {
  CASH
  MOBILE
  BANK
}

model TimelineEntry {
  id          String       @id @default(cuid())
  description String
  type        TimelineType
  createdAt   DateTime     @default(now())

  userId String
  user   User   @relation(fields: [userId], references: [id])
}

enum TimelineType {
  TRANSACTION
  EXPENSE
  PAYROLL
  NOTE
}

model StaffPayroll {
  id      String @id @default(cuid())
  staffId String
  staff   User   @relation(fields: [staffId], references: [id])

  month Int
  year  Int

  grossPay        Float
  advancesTaken   Float @default(0)
  savedAmount     Float @default(0)
  remainingAmount Float @default(0)
  netPayable      Float @default(0)

  status PayrollStatus @default(PENDING)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([staffId, month, year])
}

enum PayrollStatus {
  PENDING
  CLOSED
  PAID
}

model Expense {
  id        String          @id @default(cuid())
  title     String
  amount    Float
  category  ExpenseCategory
  notes     String?
  createdAt DateTime        @default(now())

  staffId String?
  staff   User?   @relation("StaffAdvances", fields: [staffId], references: [id])

  recordedById String
  recordedBy   User   @relation("RecordedExpenses", fields: [recordedById], references: [id])
}

enum ExpenseCategory {
  SUPPLIES
  UTILITIES
  RENT
  SALARY
  ADVANCE
  OTHER
}

model PayrollAccrual {
  id        String @id @default(cuid())
  month     String
  staffName String

  expectedPay Float
  savedSoFar  Float @default(0)
  paidSoFar   Float @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
